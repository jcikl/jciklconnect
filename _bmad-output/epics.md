---
stepsCompleted: [1, 2, 3, 4]
status: complete
completedAt: '2025-02-16'
inputDocuments:
  - _bmad-output/prd.md
  - _bmad-output/architecture.md
workflowType: 'epics-and-stories'
lastStep: 4
project_name: 'JCI LO 管理应用'
user_name: 'User'
date: '2025-02-16'
---

# JCI LO 管理应用 - Epic Breakdown

## Overview

This document provides the complete epic and story breakdown for JCI LO 管理应用, decomposing the requirements from the PRD and Architecture into implementable stories. (No UX Design document was found; UI scope follows PRD and Architecture.)

## Requirements Inventory

### Functional Requirements

- **FR1**：管理员、组织秘书 可 在系统内维护会员主档（查看、新增、修改、在权限范围内管理全部会员数据）。（MVP）
- **FR2**：会员 可 查看与维护本人主档中的允许编辑字段（个人主档）。（MVP）
- **FR3**：在至少两个业务场景（如活动报名、付款申请）中，具备相应权限的用户 可 通过选择会员身份从主档带出姓名、届别、联络方式等约定字段，减少重复填写。（MVP）
- **FR4**：系统 可 在选定的活动、会费、付款申请等场景中，根据「选会员」结果自动带出主档中约定字段。（MVP）
- **FR5**：管理员、组织秘书 可 在组织层面查看与导出主档数据，用于主档质量检查或迁移/清洗验收。（Growth）
- **FR6**：系统 可 支持将历史数据（如旧表格）按约定规则迁移或清洗后写入主档，迁移范围与验收责任在实施计划中约定。（Growth）
- **FR7**：申请方（会员或活动财政等） 可 在平台提交付款申请，并关联唯一参考编号及必填信息（如活动、金额、用途等）。（MVP）
- **FR8**：组织财政长、活动财政（在权限范围内） 可 查看付款申请统一列表，并看到简单去重或重复提示（如同一活动+同一金额+同一申请人+时间窗等规则）。（MVP）
- **FR9**：申请方 可 自助查询本人或本活动相关付款申请的状态（如待审/已批/已拒）。（MVP）
- **FR10**：具备审核权限的角色 可 对付款申请执行审核操作（批准、拒绝等），并更新申请状态。（MVP）
- **FR11**：系统 可 在付款申请全流程中承载并展示唯一参考编号，供对账与勾稽使用。（MVP）
- **FR12**：活动财政 可 仅看到与本活动相关的付款申请与状态（受权限与可见性约束）。（MVP）
- **FR13**：组织财政长、活动财政 可 在录入或查看活动流水、会费、商品销售等时使用约定格式的唯一参考编号，并与银行转账备注约定一致。（MVP）
- **FR14**：组织财政长 可 根据唯一参考编号，将银行流水与活动/会费/商品等记录做人工或半自动勾稽（匹配、标记已到账等）。（MVP）
- **FR15**：系统 可 支持按唯一参考编号或约定规则，对流水与业务记录进行查询与关联展示，以支持对账。（MVP）
- **FR16**：组织财政长、活动财政 可 对银行流水或业务流水使用规则化或半自动的类别与用途分类、拆分（如会费/活动/行政/商品）。（Growth）
- **FR17**：组织财政长 可 查看或使用多户口入账规则与错户内部转移流程/清单，减少错户核对与转移耗时。（Growth）
- **FR18**：组织财政长 可 在权限范围内查看组织级财务相关数据（如付款申请列表、流水、对账视图等）。（MVP）
- **FR19**：活动财政 可 仅在权限范围内查看与本活动相关的财务与参与数据，无法查看其他活动或组织全局敏感数据。（MVP）
- **FR20**：系统 可 按角色（组织财政、活动财政、会员、管理员、组织秘书）限制数据访问范围，使「组织财政 vs 活动财政」的可见性边界在功能上落实。（MVP）
- **FR21**：会员 可 仅查看与维护本人主档及本人相关的会费状态、参与记录、付款申请状态等。（MVP）
- **FR22**：管理员、组织秘书 可 在系统中承担宣导与主档维护责任；若角色空缺，组织 可 指定唯一宣导与主档维护负责人。（MVP）
- **FR23**：活动财政、筹委 可 在活动相关界面通过选择会员从主档带出资料，用于报名、筹委名单、讲者名单等。（MVP）
- **FR24**：系统 可 在报名、缴费、签到等环节使用统一事件流或关联数据，使名单与缴费/签到状态一致、可查。（Growth）
- **FR25**：会员 可 在系统内查看本人的活动参与记录及筹委经历（若已写入主档）。（Growth）
- **FR26**：系统 可 将活动参与与筹委经历自动写入会员主档，支撑传承与人才识别。（Growth）
- **FR27**：非会员 可 在签到或约定流程中留资（如联络方式、兴趣），组织可据此跟进与推广。（Vision，P2）
- **FR28**：系统 可 根据会员偏好或参与历史对活动进行精准推送或推荐（减少无关打扰）。（Vision，P2）
- **FR29**：系统 可 根据约定规则计算或展示会员的会费状态（如应缴/已缴/逾期），并反写或展示在会员状态与权限相关逻辑中。（Growth）
- **FR30**：会员 可 在系统内查看本人的会费状态（应缴/已缴/逾期）及参与记录。（Growth）
- **FR31**：组织财政长、具备权限的角色 可 查看或导出会费与会员状态相关数据，用于对账或运营。（Growth）
- **FR32**：管理员、组织秘书 可 在系统内或通过配套材料宣导新流程与编号规范，使新业务按规定走新流程。（MVP）
- **FR33**：用户 可 在首次使用付款申请、主档带出或编号相关流程时，获得简单说明或首次使用引导（如帮助入口、引导条、文档链接等）。（MVP）
- **FR34**：组织 可 使用文档与交接清单支持换届或角色更替，降低新流程退步风险；文档与交接责任在实施计划中约定。（Growth）
- **FR35**：活动财政、筹委代表 可 参与关键流程与验收设计（如需求评审、验收测试），以提高采纳率。（MVP，流程层面）
- **FR36**：组织 可 在实施计划中约定主档与历史数据的迁移范围、清洗规则及验收责任，并在系统中执行或支持迁移与验收流程。（Growth）
- **FR37**：系统 可 在银行/支付端无法完全配合编号规范时，支持以人工辅助匹配（半自动）方式完成对账，不阻断基本对账能力。（MVP）

### NonFunctional Requirements

- **NFR-P1**：关键用户操作（付款申请列表、按参考编号查询、主档带出）首屏或结果 3 秒内可感知完成；列表分页或懒加载。
- **NFR-P2**：对账与流水查询（典型数据量）响应时间 ≤ 5 秒；允许导出异步。
- **NFR-P3**：同一组织内至少 5 个并发用户无明显阻塞或错误率上升。
- **NFR-S1**：传输 TLS；敏感字段加密或访问控制保护。
- **NFR-S2**：访问控制与角色一致；多 LO 时租户上下文校验，禁止跨 LO 访问。
- **NFR-S3**：认证 Firebase Auth；敏感操作需已登录且角色匹配。
- **NFR-S4**：付款申请与主档关键修改可追溯操作者与时间；审计保留策略在实施/运维中约定。
- **NFR-A1**：核心流程（登录、主档、付款申请、对账）相关页面与组件满足 WCAG 2.1 Level AA。
- **NFR-A2**：关键操作具备明确成功/失败反馈，不仅依赖颜色。
- **NFR-I1**：Firestore/Auth 数据模型与安全规则开发前确认；多 LO 时规则按 loId/areaId/countryId 限制。
- **NFR-I2**：银行流水以人工上传或粘贴为主；不强制实时银行 API。
- **NFR-I3**：主档、流水、付款申请支持约定格式导出（CSV/JSON），由权限角色触发并受审计约束。
- **NFR-R1**：核心功能可用率目标 ≥ 99%（计划内维护除外）；单次不可用 >15 分钟需说明或记录。
- **NFR-R2**：付款申请与主档更新在成功确认后不因刷新丢失；成功确认指前端收到写入成功后再更新 UI。
- **NFR-R3**：付款申请/主档更新/对账操作具备可追踪标识（correlation id 或审计 ID）。
- **NFR-SC1**：数据模型预留多 LO（Country→Area→LO）；MVP 可单 LO，设计避免日后大规模重构。
- **NFR-SC2**：多 LO 时租户/组织隔离（Country/Area/LO）；预留索引与查询扩展。
- **NFR-SC3**：数据模型与 API 支持 countryId/areaId/loId 隔离查询与安全规则；Firestore 规则按 LO（及可选 Area/Country）限制。

### Additional Requirements

- **Starter / 初始化**：无新 starter；以现有代码库为基线。首条实施 Story 在现有 repo 内交付主档带出或付款申请 MVP，不运行 create-* 命令。
- **数据模型**：扩展 `members` 为主档单一来源；新建集合 `paymentRequests`（字段含 applicantId, amount, purpose/activityRef, referenceNumber, status, loId, 审计字段）；所有需隔离文档含 `loId`（必填），可选 areaId/countryId；`referenceNumber` 统一字段名；沿用 transactions/transactionSplits/reconciliations 并扩展 referenceNumber 与关联。
- **安全规则**：Firestore 规则按角色与 loId（及可选 areaId/countryId）限制；组织财政组织级、活动财政本活动、会员本人；禁止跨 LO 访问。
- **实施顺序**：① 数据模型与安全规则扩展（members、paymentRequests、loId、referenceNumber）→ ② 付款申请 MVP（提交、列表、状态、审核）→ ③ 主档带出（至少 2 个场景）→ ④ 对账与编号勾稽。
- **服务与结构**：新增 `paymentRequestService`；扩展 `membersService`、`financeService`；主档带出字段列表在 config/常量中统一维护；编号生成逻辑集中（service 或 Callable）。
- **可观测与审计**：关键写操作含 updatedBy、updatedAt；可选 correlationId；日志不记录密码或支付凭证。

### FR Coverage Map

- FR1, FR2, FR18–FR22: Epic 1（会员主档与访问控制）
- FR7–FR12: Epic 2（付款申请与审批）
- FR3, FR4, FR23: Epic 3（主档带出）
- FR13–FR15, FR37: Epic 4（唯一参考编号与对账）
- FR32, FR33, FR35: Epic 5（新流程说明与引导）
- FR5, FR6, FR36: Epic 6（主档导出与数据迁移，Growth）
- FR16, FR17: Epic 7（流水分类与多户口，Growth）
- FR24–FR26, FR29–FR31: Epic 8（活动参与与会费状态，Growth）
- FR27, FR28, FR34: Epic 9（非会员留资与活动推荐，Vision）

## Epic List

### Epic 1: 会员主档与访问控制（MVP）
管理员、组织秘书可维护会员主档，会员可查看与维护本人主档；系统按角色（组织财政、活动财政、会员、管理员、组织秘书）与多 LO 租户限制数据访问，使主档成为单一来源且权限边界落地。首几则 Story 需覆盖数据模型与 Firestore 规则扩展（members 主档字段与索引、loId、按角色与租户的访问规则），为 Epic 2/3/4 提供权限与数据基础。
**FRs covered:** FR1, FR2, FR18, FR19, FR20, FR21, FR22.

### Epic 2: 付款申请与审批（MVP）
申请方可在平台提交付款申请并关联唯一参考编号；组织/活动财政可查看统一列表与简单去重提示；申请方可自助查状态；具备审核权限的角色可批准/拒绝并更新状态；活动财政仅见本活动相关申请。
**FRs covered:** FR7, FR8, FR9, FR10, FR11, FR12.

### Epic 3: 主档带出（选会员即带出）（MVP）
在至少两个业务场景（如活动报名、付款申请）中，具备权限的用户通过选择会员身份即可带出主档约定字段；系统在选定场景中根据「选会员」结果自动带出；活动财政/筹委可在活动界面选会员带出资料。
**FRs covered:** FR3, FR4, FR23.

### Epic 4: 唯一参考编号与对账（MVP）
组织/活动财政在流水与业务中使用约定格式的唯一参考编号；组织财政可按编号将银行流水与活动/会费/商品等做人工或半自动勾稽；系统支持按编号或规则查询与关联展示；银行端无法完全配合时支持半自动对账。**依赖：** Epic 2 已实现付款申请中唯一参考编号的承载与展示。
**FRs covered:** FR13, FR14, FR15, FR37.

### Epic 5: 新流程说明与引导（MVP）
管理员/组织秘书可宣导新流程与编号规范；用户在首次使用付款申请、主档带出或编号相关流程时可获得说明或引导（帮助入口、引导条、文档链接）；活动财政/筹委代表可参与关键流程与验收设计。本 Epic 侧重宣导与统一帮助入口；各流程的首次使用引导（FR33）可在 Epic 2/3/4 中按流程分别实现（如付款申请页、主档带出页的说明或引导条）。
**FRs covered:** FR32, FR33, FR35.

### Epic 6: 主档导出与数据迁移（Growth）
管理员/组织秘书可在组织层面查看与导出主档数据；系统支持按约定规则迁移或清洗历史数据写入主档；实施计划中约定迁移范围、清洗规则及验收责任并在系统中执行或支持。
**FRs covered:** FR5, FR6, FR36.

### Epic 7: 流水分类与多户口（Growth）
组织/活动财政可对银行或业务流水使用规则化或半自动的类别与用途分类、拆分；组织财政可查看或使用多户口入账规则与错户内部转移流程/清单。
**FRs covered:** FR16, FR17.

### Epic 8: 活动参与与会费状态（Growth）
报名、缴费、签到使用统一事件流或关联数据且名单与状态一致可查；会员可查看本人活动参与记录及筹委经历；系统可将参与与筹委经历写入主档；会费状态计算与展示、会员与财政查看/导出。
**FRs covered:** FR24, FR25, FR26, FR29, FR30, FR31.

### Epic 9: 非会员留资与活动推荐（Vision）
非会员可在签到或约定流程中留资；系统可根据会员偏好或参与历史做活动精准推送或推荐；组织可使用文档与交接清单支持换届或角色更替。
**FRs covered:** FR27, FR28, FR34.

---

## Epic 1: 会员主档与访问控制（MVP）

管理员、组织秘书可维护会员主档，会员可查看与维护本人主档；系统按角色与多 LO 租户限制数据访问，使主档成为单一来源且权限边界落地。首几则 Story 需覆盖数据模型与 Firestore 规则扩展，为 Epic 2/3/4 提供基础。

### Story 1.1: 数据模型与 Firestore 规则扩展（members、loId、角色/租户）

As a 开发/架构师，  
I want members 集合扩展主档所需字段与 loId（及可选 areaId/countryId），并落实按角色与 loId 的 Firestore 安全规则，  
So that 后续付款申请、主档带出与对账能在同一套权限与租户模型上实现。

**Acceptance Criteria:**

- **Given** 现有 members 集合与现有 Auth，**When** 扩展 schema（主档带出所需字段、loId 必填），**Then** 新字段与索引在 firestore.indexes 中定义，且不破坏现有读写。
- **Given** 安全规则文件，**When** 增加按 request.auth 角色与文档 loId 的读/写限制，**Then** 组织财政可读组织级、活动财政仅本活动、会员仅本人；多 LO 时禁止跨 loId 访问。
- **Given** 任意已登录用户，**When** 访问非本人且非其角色允许的 members 文档，**Then** 规则拒绝且前端不暴露他人数据。

### Story 1.2: 管理员与组织秘书维护会员主档（查看、新增、修改）

As a 管理员或组织秘书，  
I want 在系统内查看、新增、修改会员主档（在权限范围内管理全部会员数据），  
So that 主档成为组织内会员数据的单一权威来源。

**Acceptance Criteria:**

- **Given** 已登录且角色为管理员或组织秘书，**When** 进入会员主档维护界面，**Then** 可查看列表（分页/懒加载）、按 loId 过滤（若多 LO），并可新增、编辑会员记录。
- **Given** 编辑主档，**When** 保存，**Then** 写入 members 且含 updatedBy/updatedAt；前端在收到 Firestore 成功后再更新 UI 并显示成功反馈（NFR-A2、NFR-R2）。
- **Given** 无权限或未登录，**When** 访问维护功能，**Then** 规则或 UI 禁止访问。

### Story 1.3: 会员查看与维护本人主档

As a 会员，  
I want 查看与维护本人主档中的允许编辑字段（个人主档），  
So that 我的联络方式与可编辑信息保持正确且仅本人可改。

**Acceptance Criteria:**

- **Given** 已登录会员，**When** 进入「我的主档」或等价入口，**Then** 仅展示本人文档；可编辑字段按配置（如联系方式）可保存，不可编辑字段仅只读。
- **Given** 保存本人主档，**When** 提交，**Then** 仅允许更新约定字段；规则拒绝对他人文档或受限字段的写操作。
- **Given** 成功保存，**When** 响应返回，**Then** 前端显示成功状态，不因刷新丢失（NFR-R2）。

### Story 1.4: 按角色与租户限制数据访问（组织财政/活动财政/会员边界）

As a 系统，  
I want 在 Firestore 规则与 UI 中按角色（组织财政、活动财政、会员、管理员、组织秘书）及 loId 限制数据访问，  
So that 「组织财政 vs 活动财政 vs 会员」的可见性边界在功能上落实（FR18–FR21）。

**Acceptance Criteria:**

- **Given** 组织财政长，**When** 访问财务相关列表或对账视图，**Then** 仅能读取本组织（本 loId）内数据；活动财政仅能读取本活动相关数据；会员仅本人主档及本人相关状态。
- **Given** 多 LO 启用，**When** 用户请求数据，**Then** 规则校验 request.auth 的租户上下文与文档 loId 一致，否则拒绝。
- **Given** 任意角色，**When** 访问超出其权限的数据，**Then** 规则返回拒绝；UI 不展示无权限入口或数据。

---

## Epic 2: 付款申请与审批（MVP）

申请方可在平台提交付款申请并关联唯一参考编号；组织/活动财政可查看统一列表与简单去重提示；申请方可自助查状态；具备审核权限的角色可批准/拒绝并更新状态；活动财政仅见本活动相关申请。

### Story 2.1: paymentRequests 集合与安全规则、referenceNumber 生成约定

As a 开发，  
I want 新增 paymentRequests 集合及按角色与 loId 的安全规则，并约定 referenceNumber 格式与生成方式（如 service 或 Callable），  
So that 付款申请可安全写入与按权限查询，且编号在全流程中一致可用。

**Acceptance Criteria:**

- **Given** 架构约定，**When** 创建 paymentRequests 集合，**Then** 文档含 applicantId, amount, purpose/activityRef, referenceNumber, status, loId, createdAt, updatedAt, updatedBy（及可选 reviewedBy, reviewedAt）；规则按角色与 loId 限制读/写。
- **Given** 编号生成逻辑，**When** 生成 referenceNumber，**Then** 格式与 config/常量约定一致（如含 loId、类型、日期、序号）；同一申请全流程使用同一编号。
- **Given** 活动财政，**When** 查询付款申请，**Then** 规则仅返回本活动相关文档（如 activityRef 或等效关联）。

### Story 2.2: 申请方提交付款申请（表单、关联编号与必填信息）

As a 申请方（会员或活动财政等），  
I want 在平台提交付款申请并关联唯一参考编号及必填信息（活动、金额、用途等），  
So that 申请可被追踪与对账（FR7、FR11）。

**Acceptance Criteria:**

- **Given** 已登录且具申请权限，**When** 填写付款申请表单（活动/用途、金额、必要说明），**Then** 提交后系统生成或分配 referenceNumber 并写入 paymentRequests；必填项校验通过才可提交。
- **Given** 提交成功，**When** Firestore 写入确认返回，**Then** 前端显示成功并展示申请单号/编号；列表或「我的申请」中可看到该条（FR9）。
- **Given** 提交失败（如规则拒绝、网络错误），**When** 用户重试或修正，**Then** 显示明确错误反馈，不依赖颜色 alone（NFR-A2）。

### Story 2.3: 组织/活动财政查看付款申请列表与简单去重提示

As a 组织财政长或活动财政，  
I want 查看付款申请统一列表，并看到简单去重或重复提示（如同一活动+同一金额+同一申请人+时间窗），  
So that 审核更高效且减少重复审批（FR8、FR12）。

**Acceptance Criteria:**

- **Given** 已登录且角色为组织财政或活动财政，**When** 打开付款申请列表，**Then** 列表按权限过滤（活动财政仅本活动）；支持分页或懒加载，首屏 3 秒内可感知（NFR-P1）。
- **Given** 列表数据，**When** 存在与「同一活动+同一金额+同一申请人+时间窗」匹配的多条，**Then** 在 UI 上给出重复/去重提示（可在列表行或筛选处）；不要求持久化去重记录。
- **Given** 组织财政，**When** 查看列表，**Then** 可见本组织（本 loId）内所有可见申请；活动财政仅见本活动相关。

### Story 2.4: 申请方自助查询本人或本活动付款申请状态

As a 申请方，  
I want 自助查询本人或本活动相关付款申请的状态（待审/已批/已拒），  
So that 无需通过财政口头确认即可了解进度（FR9）。

**Acceptance Criteria:**

- **Given** 已登录申请方，**When** 进入「我的申请」或按活动筛选，**Then** 仅能看到本人提交或本活动（若为活动财政）相关的申请，且每条显示状态（如 draft/submitted/approved/rejected）。
- **Given** 状态变更（如审核通过），**When** 申请方刷新或重新进入列表，**Then** 状态已更新；列表支持按状态筛选。
- **Given** 无权限的申请，**When** 请求访问，**Then** 规则禁止返回他人/他活动数据。

### Story 2.5: 审核人批准/拒绝并更新状态；活动财政仅见本活动

As a 具备审核权限的角色，  
I want 对付款申请执行批准或拒绝并更新申请状态，  
So that 审批流程闭环且状态对申请方与财政透明（FR10、FR12）。

**Acceptance Criteria:**

- **Given** 已登录且具审核权限，**When** 在列表或详情中选择「批准」或「拒绝」，**Then** 文档 status 与 reviewedBy、reviewedAt 更新；规则仅允许有审核权的角色写这些字段。
- **Given** 活动财政，**When** 查看或审核付款申请，**Then** 仅能见本活动相关申请；组织财政可审组织内可见的申请。
- **Given** 审核操作完成，**When** 写入成功，**Then** 前端显示成功/失败反馈；申请方在自助查询中可见最新状态。

---

## Epic 3: 主档带出（选会员即带出）（MVP）

在至少两个业务场景（如活动报名、付款申请）中，具备权限的用户通过选择会员身份即可带出主档约定字段；系统在选定场景中根据「选会员」结果自动带出；活动财政/筹委可在活动界面选会员带出资料。

### Story 3.1: 付款申请场景选会员即带出主档约定字段

As a 申请方或活动财政，  
I want 在付款申请流程中通过选择会员身份带出主档中的姓名、届别、联络方式等约定字段，  
So that 减少重复填写且与主档一致（FR3、FR4）。

**Acceptance Criteria:**

- **Given** 主档带出字段列表已在 config/常量中定义，**When** 用户在付款申请表单中选择会员（如搜索或下拉），**Then** 选中后自动带出约定字段（只读或可覆盖）；带出数据来自 members 且按权限查询。
- **Given** 未选会员，**When** 用户直接填写，**Then** 仍允许提交（可选校验策略由产品约定）；若选会员则优先展示带出值。
- **Given** 成功带出，**When** 用户提交申请，**Then** 申请记录可保存申请人标识与带出信息（如用于去重或展示），不要求重复存整份主档。

### Story 3.2: 活动报名/筹委场景选会员即带出主档约定字段

As a 活动财政或筹委，  
I want 在活动相关界面（报名、筹委名单、讲者名单等）通过选择会员从主档带出资料，  
So that 名单与主档一致且减少重复输入（FR23）。

**Acceptance Criteria:**

- **Given** 活动报名或筹委/讲者编辑界面，**When** 用户选择会员（搜索或选择），**Then** 主档约定字段（姓名、届别、联络方式等）自动带出；数据来源为 members，按当前用户权限过滤。
- **Given** 至少两个场景（付款申请 + 活动相关）已实现带出，**When** 验收，**Then** FR3「至少两个业务场景」满足；带出字段列表与付款申请场景一致（config/常量统一）。
- **Given** 多 LO，**When** 选择会员，**Then** 仅能选当前 loId 下会员；带出结果与主档一致。

---

## Epic 4: 唯一参考编号与对账（MVP）

组织/活动财政在流水与业务中使用约定格式的唯一参考编号；组织财政可按编号将银行流水与活动/会费/商品等做人工或半自动勾稽；系统支持按编号或规则查询与关联展示。依赖：Epic 2 已实现付款申请中唯一参考编号的承载与展示。

### Story 4.1: 流水与业务记录使用 referenceNumber、与 paymentRequests 关联

As a 组织财政或活动财政，  
I want 在录入或查看活动流水、会费、商品销售等时使用约定格式的唯一参考编号，并与银行转账备注约定一致，  
So that 流水与业务可被对账与勾稽（FR13）。

**Acceptance Criteria:**

- **Given** transactions/transactionSplits（或等价流水）文档，**When** 扩展 schema，**Then** 支持 referenceNumber 字段及与 paymentRequests/活动/会费的关联（如 paymentRequestId 或 activityRef）；格式与 Epic 2 约定一致。
- **Given** 录入流水或业务记录，**When** 用户输入或选择参考编号，**Then** 可保存并支持按 referenceNumber 查询；列表或对账视图中可展示编号与关联业务。
- **Given** 银行转账备注约定，**When** 文档中有 referenceNumber，**Then** 与约定格式一致，便于人工或半自动匹配。

### Story 4.2: 组织财政按编号勾稽、查询与关联展示；半自动对账支持

As a 组织财政长，  
I want 根据唯一参考编号将银行流水与活动/会费/商品等记录做人工或半自动勾稽（匹配、标记已到账），并支持按编号或规则查询与关联展示，  
So that 对账省时且可追溯（FR14、FR15、FR37）。

**Acceptance Criteria:**

- **Given** 对账或流水视图，**When** 用户按 referenceNumber 或时间范围筛选，**Then** 列表/关联展示在典型数据量下 5 秒内返回（NFR-P2）；支持将流水与业务记录匹配并标记已到账（如更新 reconciliations 或等效）。
- **Given** 银行流水为人工上传或粘贴，**When** 用户执行匹配，**Then** 支持人工选择对应业务记录或半自动建议（如同编号、同金额、时间窗）；不依赖实时银行 API（FR37）。
- **Given** 勾稽操作，**When** 保存，**Then** 可追溯（如 updatedBy/updatedAt 或 correlation id）；审计不记录支付凭证（NFR-R3、NFR-S4）。

---

## Epic 5: 新流程说明与引导（MVP）

管理员/组织秘书可宣导新流程与编号规范；统一帮助入口；各流程的首次使用引导（FR33）可在 Epic 2/3/4 中按流程分别实现。

### Story 5.1: 宣导与统一帮助入口（文档链接或帮助页）

As a 管理员或组织秘书，  
I want 在系统内或通过配套材料宣导新流程与编号规范，并有一处统一帮助入口（如文档链接、帮助页），  
So that 用户能找到新流程说明与编号约定（FR32、FR35）。

**Acceptance Criteria:**

- **Given** 已登录用户，**When** 访问帮助入口（如导航中的「帮助」或「新流程说明」），**Then** 可打开文档链接或内嵌说明，内容包含编号规范与新流程要点。
- **Given** 管理员/组织秘书，**When** 需要对外宣导，**Then** 可依赖该入口链接或导出简短说明；活动财政/筹委代表可参与验收设计（流程层面，FR35）。
- **Given** 核心流程（主档、付款申请、对账），**When** 用户首次使用，**Then** 可在各流程页获得简单说明或引导条（与 Epic 2/3/4 中已实现的引导一致，FR33）。

---

## Epic 6: 主档导出与数据迁移（Growth）

管理员/组织秘书可在组织层面查看与导出主档数据；系统支持按约定规则迁移或清洗历史数据写入主档；实施计划中约定迁移范围、清洗规则及验收责任。

### Story 6.1: 组织层面主档导出与迁移/清洗支持

As a 管理员或组织秘书，  
I want 在组织层面查看与导出主档数据，并支持按约定规则执行或支持迁移/清洗写入主档，  
So that 主档质量检查与迁移验收可行（FR5、FR6、FR36）。

**Acceptance Criteria:**

- **Given** 权限为管理员或组织秘书，**When** 触发主档导出，**Then** 按约定格式（如 CSV/JSON）导出，且受审计约束；导出范围受 loId/权限限制。
- **Given** 实施计划中约定的迁移范围与清洗规则，**When** 执行迁移或清洗流程（脚本或 Callable），**Then** 数据写入 members 且可验收；责任与验收标准在实施计划中明确（FR36）。

---

## Epic 7: 流水分类与多户口（Growth）

组织/活动财政可对银行或业务流水使用规则化或半自动的类别与用途分类、拆分；组织财政可查看或使用多户口入账规则与错户内部转移流程/清单。

### Story 7.1: 流水分类与多户口规则/清单

As a 组织财政或活动财政，  
I want 对银行或业务流水使用规则化或半自动的类别与用途分类、拆分，并查看或使用多户口入账规则与错户内部转移流程/清单，  
So that 分类与多户口处理更省时（FR16、FR17）。

**Acceptance Criteria:**

- **Given** 流水数据，**When** 用户执行分类或拆分，**Then** 支持按规则或半自动建议（如会费/活动/行政/商品）；结果可保存并用于报表或对账。
- **Given** 多户口与错户场景，**When** 组织财政查看清单或流程，**Then** 可查看或使用多户口入账规则与错户内部转移流程/清单，减少核对与转移耗时。

---

## Epic 8: 活动参与与会费状态（Growth）

报名、缴费、签到一致可查；会员可查看本人活动参与记录及筹委经历；系统可将参与与筹委经历写入主档；会费状态计算与展示、会员与财政查看/导出。

### Story 8.1: 活动参与一致性与会费状态展示

As a 会员或财政，  
I want 报名/缴费/签到名单与状态一致可查，会费状态（应缴/已缴/逾期）与参与记录可查看，参与与筹委经历可写入主档，  
So that 参与与会费状态透明且可沉淀（FR24–FR26、FR29–FR31）。

**Acceptance Criteria:**

- **Given** 活动报名、缴费、签到，**When** 使用统一事件流或关联数据，**Then** 名单与缴费/签到状态一致、可查。
- **Given** 会员，**When** 查看本人信息，**Then** 可查看本人活动参与记录及筹委经历（若已写入主档）；会费状态（应缴/已缴/逾期）可查看。
- **Given** 系统规则，**When** 参与或筹委经历产生，**Then** 可自动或经流程写入 members 主档；组织财政/权限角色可查看或导出会费与会员状态相关数据。

---

## Epic 9: 非会员留资与活动推荐（Vision）

非会员可在签到或约定流程中留资；系统可根据会员偏好或参与历史做活动精准推送或推荐；组织可使用文档与交接清单支持换届或角色更替。

### Story 9.1: 非会员留资、活动推荐与交接文档支持

As a 非会员或会员或管理员，  
I want 非会员在签到或约定流程中留资、会员获得基于偏好/参与历史的活动推荐、组织有文档与交接清单支持换届，  
So that 获客与留存改善、换届可持续（FR27、FR28、FR34）。

**Acceptance Criteria:**

- **Given** 非会员在签到或约定流程，**When** 留资（联络方式、兴趣），**Then** 数据可存储并供组织跟进与推广（FR27）。
- **Given** 会员偏好或参与历史，**When** 推送或推荐活动，**Then** 可减少无关打扰（FR28）；实现方式可为规则或简单推荐逻辑。
- **Given** 换届或角色更替，**When** 使用文档与交接清单，**Then** 责任在实施计划中约定；系统可提供入口或链接（FR34）。
